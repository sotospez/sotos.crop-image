/*! 
 Name        : sotos.crop-image 
 Version     : 0.0.8 
 Author      :  - 
 Date        : 08-10-2015 
 Description : crop images, put watermark and save directive in angular  
 Homepage    : https://github.com/sotospez/sotos.crop-image#readme 
 Demopage    : http://sotos.gr/demos/crop-image/ 
 */
angular.module("sotos.crop-image",[]),angular.module("sotos.crop-image").directive("imageCrop",["$window",function(a){return{restrict:"E",transclude:!0,scope:{cropOptions:"=cropOptions",imageOut:"=",cropImageSave:"&"},controller:["$scope",function(b){var c,d,e,f,g,h,i,j,k=new Image;k.setAttribute("crossOrigin","anonymous");var l=new Image;l.setAttribute("crossOrigin","anonymous");var m,n,o=0,p=this;b.cropOptions=b.cropOptions||{},this.cropOptions=b.cropOptions,b.cropOptions.viewSizeWidth=b.cropOptions.viewSizeWidth||"480",b.cropOptions.viewSizeWidth=b.cropOptions.viewSizeWidth+"",b.cropOptions.viewSizeHeight=b.cropOptions.viewSizeHeight||"360",b.cropOptions.viewSizeHeight=b.cropOptions.viewSizeHeight+"",b.cropOptions.viewSizeFixed=b.cropOptions.viewSizeFixed||!1,b.cropOptions.viewShowFixedBtn=!1,"undefined"==typeof b.cropOptions.viewShowRotateBtn&&(b.cropOptions.viewShowRotateBtn=!0),"undefined"==typeof b.cropOptions.rotateRadiansLock&&(b.cropOptions.rotateRadiansLock=!0),b.cropOptions.outputImageWidth=b.cropOptions.outputImageWidth||0,b.cropOptions.outputImageHeight=b.cropOptions.outputImageHeight||0,"undefined"==typeof b.cropOptions.outputImageRatioFixed&&(b.cropOptions.outputImageRatioFixed=!0),b.cropOptions.outputImageType=b.cropOptions.outputImageType||"jpeg","undefined"==typeof b.cropOptions.outputImageSelfSizeCrop&&(b.cropOptions.outputImageSelfSizeCrop=!0),"undefined"==typeof b.cropOptions.viewShowCropTool&&(b.cropOptions.viewShowCropTool=!0),b.cropOptions.watermarkType=b.cropOptions.watermarkType||"text",b.cropOptions.watermarkImage=b.cropOptions.watermarkImage||null,b.cropOptions.watermarkText=b.cropOptions.watermarkText||null,b.cropOptions.watermarkTextFillColor=b.cropOptions.watermarkTextFillColor||"rgba(0,0, 0, 0.8)",b.cropOptions.watermarkTextStrokeColor=b.cropOptions.watermarkTextFillColor||"rgba(255,0, 0, 0.8)",b.cropOptions.watermarkTextStrokeLineWidth=b.cropOptions.watermarkTextStrokeLineWidth||1,b.cropOptions.watermarkTextFont=b.cropOptions.watermarkTextFont||"Arial",b.cropOptions.inModal=b.cropOptions.inModal||!1,this.inModal=b.cropOptions.inModal,"jpg"===b.cropOptions.outputImageType&&(n="image/jpeg"),"jpeg"===b.cropOptions.outputImageType&&(n="image/jpeg"),"png"===b.cropOptions.outputImageType&&(n="image/png");var q=function(a,c,d,e){this.x=a,this.y=c,this.w=d,this.h=e,this.px=a,this.py=c,this.csize=6,this.csizeh=10,this.bHow=[!1,!1,!1,!1,!1],this.iCSize=[this.csize,this.csize,this.csize,this.csize,this.csize],this.bDrag=[!1,!1,!1,!1,!1],this.bDragAll=!1,this.rotateCenter={},this.rotateCenter.angle=.005,this.rotateCenter.angleRotate=1,this.rotateCenter.rotateRadiansLock=b.cropOptions.rotateRadiansLock,this.rotateCenter.isrotate=!1,this.rotateCenter.r=this.w>this.h?this.w:this.h,this.rotateCenter.r=this.rotateCenter.r/Math.PI,this.rotateCenter.x=this.x+this.w/2,this.rotateCenter.sx=this.rotateCenter.x+this.rotateCenter.r*Math.cos(this.rotateCenter.angle),this.rotateCenter.y=this.y+this.h/2,this.rotateCenter.sy=this.rotateCenter.y+this.rotateCenter.r*Math.sin(this.rotateCenter.angle),this.ratioHover=!1,this.ratioOn=!1,this.ratioSize=6,this.sizeOutRatio=0,this.watermarkTextSpace=20};q.prototype.drawRatio=function(){b.cropOptions.viewShowFixedBtn&&(g.lineWidth=1,g.strokeStyle="#eee",g.font="20px Arial",g.fillStyle="#eee",g.fillText("Ratio",8,60),g.beginPath(),g.arc(65,55,this.ratioSize,0,2*Math.PI,!1),b.cropOptions.outputImageRatioFixed&&(g.fillStyle="rgba(51,184, 229, 0.9)",g.fill()),g.lineWidth=3,g.strokeStyle="rgba(0,153, 205, 0.8)",g.stroke())},q.prototype.drawWaterMarkImage=function(){this.w>this.h?this.h=this.w/o:this.w=this.h*o,g.drawImage(l,this.x,this.y,this.w,this.h),g.strokeStyle="#000",g.lineWidth=2,g.strokeRect(this.x,this.y,this.w,this.h),this.w>0&&this.h>0&&(h.clearRect(0,0,e.width,e.height),j.drawImage(l,this.x*m,this.y*m,this.w*m,this.h*m),h.drawImage(f,0,0,e.width,e.height)),g.fillStyle="rgba(119,206, 238, 0.9)",g.fillRect(this.x-this.iCSize[0],this.y-this.iCSize[0],2*this.iCSize[0],2*this.iCSize[0]),g.fillRect(this.x+this.w-this.iCSize[1],this.y-this.iCSize[1],2*this.iCSize[1],2*this.iCSize[1]),g.fillRect(this.x+this.w-this.iCSize[2],this.y+this.h-this.iCSize[2],2*this.iCSize[2],2*this.iCSize[2]),g.fillRect(this.x-this.iCSize[3],this.y+this.h-this.iCSize[3],2*this.iCSize[3],2*this.iCSize[3]),g.lineWidth=1,g.strokeRect(this.x-this.iCSize[0],this.y-this.iCSize[0],2*this.iCSize[0],2*this.iCSize[0]),g.strokeRect(this.x+this.w-this.iCSize[1],this.y-this.iCSize[1],2*this.iCSize[1],2*this.iCSize[1]),g.strokeRect(this.x+this.w-this.iCSize[2],this.y+this.h-this.iCSize[2],2*this.iCSize[2],2*this.iCSize[2]),g.strokeRect(this.x-this.iCSize[3],this.y+this.h-this.iCSize[3],2*this.iCSize[3],2*this.iCSize[3])},q.prototype.drawWaterMarkText=function(){if(g.font=this.h+"px "+b.cropOptions.watermarkTextFont,g.fillStyle=b.cropOptions.watermarkTextFillColor,g.fillText(b.cropOptions.watermarkText,this.x+this.watermarkTextSpace,this.y+this.h-this.h/4,this.w-this.watermarkTextSpace-this.watermarkTextSpace),g.strokeStyle="#000",g.lineWidth=2,g.strokeRect(this.x,this.y,this.w,this.h),this.w>0&&this.h>0){h.clearRect(0,0,e.width,e.height),j.lineWidth=b.cropOptions.watermarkTextStrokeLineWidth,j.strokeStyle=b.cropOptions.watermarkTextFillColor;var a=this.h*m;j.font=a+"px "+b.cropOptions.watermarkTextFont,j.fillStyle=b.cropOptions.watermarkTextFillColor,j.fillText(b.cropOptions.watermarkText,(this.x+this.watermarkTextSpace)*m,(this.y+this.h-this.h/4)*m,(this.w-this.watermarkTextSpace-this.watermarkTextSpace)*m),h.drawImage(f,0,0,e.width,e.height)}g.fillStyle="rgba(119,206, 238, 0.9)",g.fillRect(this.x-this.iCSize[0],this.y-this.iCSize[0],2*this.iCSize[0],2*this.iCSize[0]),g.fillRect(this.x+this.w-this.iCSize[1],this.y-this.iCSize[1],2*this.iCSize[1],2*this.iCSize[1]),g.fillRect(this.x+this.w-this.iCSize[2],this.y+this.h-this.iCSize[2],2*this.iCSize[2],2*this.iCSize[2]),g.fillRect(this.x-this.iCSize[3],this.y+this.h-this.iCSize[3],2*this.iCSize[3],2*this.iCSize[3]),g.lineWidth=1,g.strokeRect(this.x-this.iCSize[0],this.y-this.iCSize[0],2*this.iCSize[0],2*this.iCSize[0]),g.strokeRect(this.x+this.w-this.iCSize[1],this.y-this.iCSize[1],2*this.iCSize[1],2*this.iCSize[1]),g.strokeRect(this.x+this.w-this.iCSize[2],this.y+this.h-this.iCSize[2],2*this.iCSize[2],2*this.iCSize[2]),g.strokeRect(this.x-this.iCSize[3],this.y+this.h-this.iCSize[3],2*this.iCSize[3],2*this.iCSize[3])},q.prototype.drawRotate=function(){b.cropOptions.viewShowRotateBtn&&(this.rotateCenter.rotateRadiansLock=b.cropOptions.rotateRadiansLock,this.rotateCenter.r=this.w>this.h?this.w:this.h,this.rotateCenter.r=Math.floor(this.rotateCenter.r/Math.PI),this.rotateCenter.x=Math.floor(this.x+this.w/2),this.rotateCenter.sx=Math.floor(this.rotateCenter.x+this.rotateCenter.r*Math.cos(this.rotateCenter.angleRotate)),this.rotateCenter.y=Math.floor(this.y+this.h/2),this.rotateCenter.sy=Math.floor(this.rotateCenter.y+this.rotateCenter.r*Math.sin(this.rotateCenter.angleRotate)),g.beginPath(),g.arc(this.rotateCenter.x,this.rotateCenter.y,this.rotateCenter.r,0,2*Math.PI,!1),g.lineWidth=5,g.strokeStyle="rgba(200,200, 200, 0.5)",g.stroke(),g.closePath(),g.beginPath(),g.arc(this.rotateCenter.x,this.rotateCenter.y,this.rotateCenter.r,0,this.rotateCenter.angleRotate,!1),g.lineWidth=5,g.strokeStyle="rgba(153, 205,0, 0.8)",g.stroke(),g.closePath(),g.beginPath(),g.arc(this.rotateCenter.sx,this.rotateCenter.sy,this.iCSize[4],0,2*Math.PI,!1),g.fillStyle="rgba(51,184, 229,0.8)",g.fill(),g.lineWidth=5,g.strokeStyle="rgba(0, 153,204, 0.6)",g.stroke(),g.closePath())},q.prototype.draw=function(){this.sizeOutRatio=b.cropOptions.outputImageWidth/b.cropOptions.outputImageHeight,b.cropOptions.outputImageRatioFixed&&(this.w>this.h?this.h=this.w/this.sizeOutRatio:this.w=this.h*this.sizeOutRatio),g.fillStyle="rgba(0, 0, 0, 0.5)",g.fillRect(0,0,g.canvas.width,g.canvas.height),g.strokeStyle="#000",g.lineWidth=2,g.strokeRect(this.x,this.y,this.w,this.h),this.w>0&&this.h>0&&(g.drawImage(e,this.x,this.y,this.w,this.h,this.x,this.y,this.w,this.h),h.clearRect(0,0,e.width,e.height),h.drawImage(f,this.x*m,this.y*m,this.w*m,this.h*m,this.x,this.y,this.w,this.h)),g.fillStyle="rgba(119,206, 238, 0.9)",g.fillRect(this.x-this.iCSize[0],this.y-this.iCSize[0],2*this.iCSize[0],2*this.iCSize[0]),g.fillRect(this.x+this.w-this.iCSize[1],this.y-this.iCSize[1],2*this.iCSize[1],2*this.iCSize[1]),g.fillRect(this.x+this.w-this.iCSize[2],this.y+this.h-this.iCSize[2],2*this.iCSize[2],2*this.iCSize[2]),g.fillRect(this.x-this.iCSize[3],this.y+this.h-this.iCSize[3],2*this.iCSize[3],2*this.iCSize[3]),g.lineWidth=1,g.strokeRect(this.x-this.iCSize[0],this.y-this.iCSize[0],2*this.iCSize[0],2*this.iCSize[0]),g.strokeRect(this.x+this.w-this.iCSize[1],this.y-this.iCSize[1],2*this.iCSize[1],2*this.iCSize[1]),g.strokeRect(this.x+this.w-this.iCSize[2],this.y+this.h-this.iCSize[2],2*this.iCSize[2],2*this.iCSize[2]),g.strokeRect(this.x-this.iCSize[3],this.y+this.h-this.iCSize[3],2*this.iCSize[3],2*this.iCSize[3])},this.drawScene=function(){g.clearRect(0,0,g.canvas.width,g.canvas.height),g.drawImage(k,0,0,g.canvas.width,g.canvas.height),i.save(),j.save(),i.clearRect(0,0,g.canvas.width,g.canvas.height),j.clearRect(0,0,k.width,k.height),i.translate(e.width/2,e.height/2),j.translate(k.width/2,k.height/2),i.rotate(r.rotateCenter.angleRotate),j.rotate(r.rotateCenter.angleRotate),i.drawImage(k,-c.width/2,-c.height/2,c.width,c.height),j.drawImage(k,-k.width/2,-k.height/2,k.width,k.height),i.restore(),j.restore(),b.cropOptions.viewShowCropTool?(r.x<0&&(r.x=0),r.y<0&&(r.y=0),r.x+r.w>g.canvas.width&&(r.x=g.canvas.width-r.w),r.y+r.h>g.canvas.height&&(r.y=g.canvas.height-r.h),r.draw(),r.drawRotate()):("image"===b.cropOptions.watermarkType&&(b.cropOptions.watermarkImage?r.drawWaterMarkImage():(h.clearRect(0,0,e.width,e.height),h.drawImage(f,0,0,e.width,e.height))),"text"===b.cropOptions.watermarkType&&(angular.isString(b.cropOptions.watermarkText)?r.drawWaterMarkText():(h.clearRect(0,0,e.width,e.height),h.drawImage(f,0,0,e.width,e.height))))},this.getEditCanvas=function(){return c},this.getViewCanvas=function(){return d},this.getImage=function(){if(b.cropOptions.viewShowCropTool){var a,c;c=document.createElement("canvas"),a=c.getContext("2d"),b.cropOptions.outputImageRatioFixed?(c.width=b.cropOptions.outputImageWidth,c.height=b.cropOptions.outputImageHeight):r.w>r.h?(c.width=r.w/(r.w/b.cropOptions.outputImageWidth),c.height=r.h/(r.w/b.cropOptions.outputImageWidth)):(c.width=r.w/(r.h/b.cropOptions.outputImageHeight),c.height=r.h/(r.h/b.cropOptions.outputImageHeight)),b.cropOptions.outputImageSelfSizeCrop&&(c.width=r.w*m,c.height=r.h*m),a.drawImage(f,r.x*m,r.y*m,r.w*m,r.h*m,0,0,c.width,c.height),b.cropOptions.image=c.toDataURL(n),b.imageOut=b.cropOptions.image,b.cropOptions.viewShowCropTool=!1}};var r=new q(50,50,50,50);c=document.createElement("canvas"),g=c.getContext("2d"),d=document.createElement("canvas"),h=d.getContext("2d"),e=document.createElement("canvas"),i=e.getContext("2d"),f=document.createElement("canvas"),j=f.getContext("2d");var s=function(){r.rotateCenter.angleRotate=0,(0===b.cropOptions.outputImageWidth||0===b.cropOptions.outputImageHeight)&&(b.cropOptions.outputImageWidth=k.width,b.cropOptions.outputImageHeight=k.height),m=k.width/b.cropOptions.viewSizeWidth,k.width<k.height&&(m=k.height/b.cropOptions.viewSizeHeight),f.width=k.width,f.height=k.height,c.width=k.width/m,c.height=k.height/m,d.width=c.width,d.height=c.height,e.width=c.width,e.height=c.height,p.drawScene()};k.onload=function(){s()};var t=null,u=null;if("%"===b.cropOptions.viewSizeWidth.substring(b.cropOptions.viewSizeWidth.length-1)||"%"===b.cropOptions.viewSizeHeight.substring(b.cropOptions.viewSizeHeight.length-1)){var v=angular.element(a),w=function(){t=t||b.cropOptions.viewSizeWidth.substring(0,b.cropOptions.viewSizeWidth.length-1),u=u||b.cropOptions.viewSizeHeight.substring(0,b.cropOptions.viewSizeHeight.length-1),b.cropOptions.viewSizeWidth=Math.round(a.innerWidth*t/100)+"",b.cropOptions.viewSizeHeight=Math.round(a.innerHeight*u/100)+"",s()};v.bind("resize",w),w()}this.theSelection=r;var x=function(){k.src=b.cropOptions.image};l.onload=function(){o=l.width/l.height,r.x=c.width/4,r.y=c.height/5,r.w=c.width/2,r.h=c.width/2/o,p.drawScene()};var y=function(){b.cropOptions.watermarkImage?l.src=b.cropOptions.watermarkImage:(l.src="",p.drawScene())};b.$watch("cropOptions.image",x),b.$watch("cropOptions.watermarkImage",y),b.$watch("cropOptions.watermarkText",x),b.$on("cropImageSave",function(){b.imageOut=f.toDataURL(n),b.cropImageSave()(b.imageOut)}),b.$on("cropImageShow",function(){b.imageOut=f.toDataURL(n)}),b.$on("cropImage",p.getImage),x()}]}}]),angular.module("sotos.crop-image").directive("editCrop",["$window",function(a){return{require:"^imageCrop",restrict:"E",scope:!1,link:function(a,b,c,d){var e,f=0,g=1,h=!1,i=d.getEditCanvas(),j=function(a){a=a[0];var b=0,c=0;if(a.offsetParent){do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{left:b,top:c}}},k=function(a){e=j(b.children()),d.inModal?(f=Math.floor(a.clientX-e.left),g=Math.floor(a.clientY-e.top)):h?(f=Math.floor(a.targetTouches[0].pageX-e.left),g=Math.floor(a.targetTouches[0].pageY-e.top)):(f=Math.floor(a.pageX-e.left),g=Math.floor(a.pageY-e.top)),d.theSelection.rotateCenter.isrotate=!1,d.theSelection.bDragAll&&(d.theSelection.x=f-d.theSelection.px,d.theSelection.y=g-d.theSelection.py);for(var c=0;5>c;c++)d.theSelection.bHow[c]=!1,d.theSelection.iCSize[c]=d.theSelection.csize;d.theSelection.ratioHover=!1,d.theSelection.ratioSize=6,f>d.theSelection.x-d.theSelection.csizeh&&f<d.theSelection.x+d.theSelection.csizeh&&g>d.theSelection.y-d.theSelection.csizeh&&g<d.theSelection.y+d.theSelection.csizeh&&(d.theSelection.bHow[0]=!0,d.theSelection.iCSize[0]=d.theSelection.csizeh),f>d.theSelection.x+d.theSelection.w-d.theSelection.csizeh&&f<d.theSelection.x+d.theSelection.w+d.theSelection.csizeh&&g>d.theSelection.y-d.theSelection.csizeh&&g<d.theSelection.y+d.theSelection.csizeh&&(d.theSelection.bHow[1]=!0,d.theSelection.iCSize[1]=d.theSelection.csizeh),f>d.theSelection.x+d.theSelection.w-d.theSelection.csizeh&&f<d.theSelection.x+d.theSelection.w+d.theSelection.csizeh&&g>d.theSelection.y+d.theSelection.h-d.theSelection.csizeh&&g<d.theSelection.y+d.theSelection.h+d.theSelection.csizeh&&(d.theSelection.bHow[2]=!0,d.theSelection.iCSize[2]=d.theSelection.csizeh),f>d.theSelection.x-d.theSelection.csizeh&&f<d.theSelection.x+d.theSelection.csizeh&&g>d.theSelection.y+d.theSelection.h-d.theSelection.csizeh&&g<d.theSelection.y+d.theSelection.h+d.theSelection.csizeh&&(d.theSelection.bHow[3]=!0,d.theSelection.iCSize[3]=d.theSelection.csizeh),f>d.theSelection.rotateCenter.sx-d.theSelection.csizeh&&f<d.theSelection.rotateCenter.sx+d.theSelection.csizeh&&g>d.theSelection.rotateCenter.sy-d.theSelection.csizeh&&g<d.theSelection.rotateCenter.sy+d.theSelection.csizeh&&(d.theSelection.bHow[4]=!0,d.theSelection.iCSize[4]=d.theSelection.csizeh),f>40&&70>f&&g>50&&60>g&&(d.theSelection.ratioHover=!0,d.theSelection.ratioSize=10);var i,k,l,m;if(d.theSelection.bDrag[0]&&(l=f-d.theSelection.px,m=g-d.theSelection.py,i=d.theSelection.w+d.theSelection.x-l,k=d.theSelection.h+d.theSelection.y-m),d.theSelection.bDrag[1]&&(l=d.theSelection.x,m=g-d.theSelection.py,i=f-d.theSelection.px-l,k=d.theSelection.h+d.theSelection.y-m),d.theSelection.bDrag[2]&&(l=d.theSelection.x,m=d.theSelection.y,i=f-d.theSelection.px-l,k=g-d.theSelection.py-m),d.theSelection.bDrag[3]&&(l=f-d.theSelection.px,m=d.theSelection.y,i=d.theSelection.w+d.theSelection.x-l,k=g-d.theSelection.py-m),d.theSelection.bDrag[4]){d.theSelection.rotateCenter.isrotate=!0;var n=Math.atan2(g-d.theSelection.rotateCenter.y,f-d.theSelection.rotateCenter.x);if(d.theSelection.rotateCenter.rotateRadiansLock){var o=Math.PI/180;n>0&&20*o>n&&(d.theSelection.rotateCenter.angleRotate=0),n>20*o&&45*o>n&&(d.theSelection.rotateCenter.angleRotate=45*o),n>45*o&&90*o>n&&(d.theSelection.rotateCenter.angleRotate=90*o),n>90*o&&135*o>n&&(d.theSelection.rotateCenter.angleRotate=135*o),n>135*o&&180*o>n&&(d.theSelection.rotateCenter.angleRotate=180*o),0>n&&n>20*o*-1&&(d.theSelection.rotateCenter.angleRotate=0),20*o*-1>n&&n>45*o*-1&&(d.theSelection.rotateCenter.angleRotate=45*o*-1),45*o*-1>n&&n>90*o*-1&&(d.theSelection.rotateCenter.angleRotate=90*o*-1),90*o*-1>n&&n>135*o*-1&&(d.theSelection.rotateCenter.angleRotate=135*o*-1),135*o*-1>n&&n>180*o*-1&&(d.theSelection.rotateCenter.angleRotate=180*o*-1)}else d.theSelection.rotateCenter.angleRotate=n}i>2*d.theSelection.csizeh&&k>2*d.theSelection.csizeh&&(d.theSelection.w=i,d.theSelection.h=k,d.theSelection.x=l,d.theSelection.y=m),d.drawScene()},l=function(a){e=j(b.children()),d.inModal?(f=Math.floor(a.clientX-e.left),g=Math.floor(a.clientY-e.top)):h?(f=Math.floor(a.targetTouches[0].pageX-e.left),g=Math.floor(a.targetTouches[0].pageY-e.top)):(f=Math.floor(a.pageX-e.left),g=Math.floor(a.pageY-e.top)),d.theSelection.px=f-d.theSelection.x,d.theSelection.py=g-d.theSelection.y,d.theSelection.bHow[0]&&(d.theSelection.px=f-d.theSelection.x,d.theSelection.py=g-d.theSelection.y),d.theSelection.bHow[1]&&(d.theSelection.px=f-d.theSelection.x-d.theSelection.w,d.theSelection.py=g-d.theSelection.y),d.theSelection.bHow[2]&&(d.theSelection.px=f-d.theSelection.x-d.theSelection.w,d.theSelection.py=g-d.theSelection.y-d.theSelection.h),d.theSelection.bHow[3]&&(d.theSelection.px=f-d.theSelection.x,d.theSelection.py=g-d.theSelection.y-d.theSelection.h),d.theSelection.ratioHover&&(d.theSelection.ratioOn=!d.theSelection.ratioOn),f>d.theSelection.x+d.theSelection.csizeh&&f<d.theSelection.x+d.theSelection.w-d.theSelection.csizeh&&g>d.theSelection.y+d.theSelection.csizeh&&g<d.theSelection.y+d.theSelection.h-d.theSelection.csizeh&&(d.theSelection.bHow[4]||(d.theSelection.bDragAll=!0));for(var c=0;5>c;c++)d.theSelection.bHow[c]&&(d.theSelection.bDrag[c]=!0)},m=function(a){d.theSelection.bDragAll=!1;for(var b=0;5>b;b++)d.theSelection.bDrag[b]=!1;d.theSelection.px=0,d.theSelection.py=0},n=function(a){h=!0,l(a)},o=function(a){h=!0,k(a)},p=function(a){h=!1,m(a)};b.bind("mousemove",k),b.bind("mousedown",l),b.bind("mouseup",m),b.bind("touchstart",n),b.bind("touchmove",o),b.bind("touchend",p),b.append(i)}}}]),angular.module("sotos.crop-image").directive("viewCrop",[function(){return{require:"^imageCrop",restrict:"E",scope:!1,link:function(a,b,c,d){b.append(d.getViewCanvas())}}}]);